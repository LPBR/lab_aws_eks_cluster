# [LAB] AWS EKS cluster
A laboratory for EKS cluster wiht nodes connection latency monitoring, using Prometheus and Grafana
## Dependencies
- AWS CLI (https://github.com/aws/aws-cli)
  > Execute `$ aws configure ` (https://github.com/aws/aws-cli#configuration)
- Terraform (https://learn.hashicorp.com/tutorials/terraform/install-cli)
## Usage
Install terraform dependencies
```
terraform init
```
Previews the execution plan and apply it
```
terraform plan
```
```
terraform apply
```
### Aply kubeconfig
```
aws eks update-kubeconfig --name eks_lab_cluster --region us-west-1
```
### Acessing Grafana
Acess grafana using port forward
```
kubectl port-forward service/prometheus-community-grafana 3000:80 -n monitoring
```
Access http://localhost:3000
 > username: admin

> password: admin123
## Clean up
To clean up created resources and avoid costs don't forget to run
```
terraform destroy
```
## Documentation
Documentation generated using terraform-docs
https://github.com/terraform-docs/terraform-docs
```
terraform-docs markdown . | tee README.md
```

## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >= 0.13 |
| <a name="requirement_aws"></a> [aws](#requirement\_aws) | ~> 3.0 |
| <a name="requirement_helm"></a> [helm](#requirement\_helm) | 2.2.0 |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_aws"></a> [aws](#provider\_aws) | 3.52.0 |
| <a name="provider_helm"></a> [helm](#provider\_helm) | 2.2.0 |

## Modules

| Name | Source | Version |
|------|--------|---------|
| <a name="module_eks"></a> [eks](#module\_eks) | terraform-aws-modules/eks/aws | 17.1.0 |
| <a name="module_networking"></a> [networking](#module\_networking) | ./networking | n/a |

## Resources

| Name | Type |
|------|------|
| [helm_release.prometheus](https://registry.terraform.io/providers/hashicorp/helm/2.2.0/docs/resources/release) | resource |
| [aws_eks_cluster.cluster](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/eks_cluster) | data source |
| [aws_eks_cluster_auth.cluster](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/eks_cluster_auth) | data source |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_cluster_name"></a> [cluster\_name](#input\_cluster\_name) | Name of the cluster | `string` | `"lab_cluster"` | no |
| <a name="input_region"></a> [region](#input\_region) | AWS region | `string` | `"us-west-1"` | no |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_cluster_endpoint"></a> [cluster\_endpoint](#output\_cluster\_endpoint) | Endpoint for EKS control plane. |
| <a name="output_cluster_id"></a> [cluster\_id](#output\_cluster\_id) | EKS cluster ID. |
| <a name="output_cluster_name"></a> [cluster\_name](#output\_cluster\_name) | Kubernetes Cluster Name |
| <a name="output_config_map_aws_auth"></a> [config\_map\_aws\_auth](#output\_config\_map\_aws\_auth) | A kubernetes configuration to authenticate to this EKS cluster. |
| <a name="output_kubectl_config"></a> [kubectl\_config](#output\_kubectl\_config) | kubectl config as generated by the module. |
